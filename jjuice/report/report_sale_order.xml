<?xml version="1.0" encoding="utf-8"?>
<openerp>
	<data>
		<template id="report_qweb_order_attachment">
			<t t-call="report.html_container">
				<t t-call="report.external_layout">
					<div class="oe_structure"/>
					 <t t-foreach="docs" t-as="o">
				        <div class="page">
				            <div class="row">
	                       		<t t-if="data['shipping_stamp']">
						        	<div class="pull-right watermark" style="position:absolute;opacity:0.6;font-size:3em;left:35%;top:10px;z-index:1000;">
						        		<p>
						        			<span t-field="o.company_id.ship_image"  t-field-options="{&quot;widget&quot;: &quot;image&quot;, &quot;class&quot;: &quot;img-rounded&quot;}"  />
						        		</p>
						        	</div>	                       		
	                       		</t>				                
				                <div class="col-xs-6">
				                    <strong t-if="o.partner_shipping_id == o.partner_invoice_id">Invoice and shipping address:</strong>
				                    <strong t-if="o.partner_shipping_id != o.partner_invoice_id">Invoice address:</strong>
				                    <div t-field="o.partner_invoice_id" 
				                        t-field-options='{"widget": "contact", "fields": ["address", "name", "phone", "fax"], "no_marker": true}'/>
				                    <p t-if="o.partner_id.vat">VAT: <span t-field="o.partner_id.vat"/></p>
				                    <div t-if="o.partner_shipping_id != o.partner_invoice_id" class="mt8">
				                        <strong>Shipping address:</strong>
				                        <div t-field="o.partner_shipping_id" 
				                            t-field-options='{"widget": "contact", "fields": ["address", "name", "phone", "fax"], "no_marker": true}'/>
				                        <p t-if="o.partner_id.vat">VAT: <span t-field="o.partner_id.vat"/></p>
				                    </div>                        
				                </div>
				                <br/>
				                <div class="col-xs-5 col-xs-offset-1">
				                    <div t-field="o.partner_id"
				                        t-field-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": true}' />
				                </div>
				            </div>
				            <br/>
				            <br/>
				            <t t-set = "info" t-value = "data['vals']"/>
							<t t-foreach = "data['vol_dict']" t-as = "volume">
								<span><strong t-esc="data['vol_dict'][volume]"></strong></span>
								<table class = "table">
									<thead>
										<th>Flavor</th>
										<t t-foreach = "data['conc_dict']" t-as="conc">
											<th t-esc = "conc[1]"></th>
										</t>
									</thead>
									<tbody>
										<t t-foreach="data['vals']" t-as = "flavour">
											<t t-if = "volume in flavour">
												<tr>
													<td>
														<span t-esc="flavour['name']"></span>
													</td>
													<t t-foreach = "data['conc_dict']" t-as = "conc">
														<td>
															<t t-if="str(conc[0]) in flavour[volume]['conc']">
																<span t-esc="flavour[volume]['conc'][str(conc[0])]" ></span>
															</t>														
														</td>
													</t>												
												</tr>											
											</t>
										</t>
										<tr>
											<td>Total</td>
											<t t-foreach = "data['conc_dict']" t-as = "conc">
												<td>
													<t t-if = "data['strength']">
														<t t-if="data['strength'].get(volume,False)">
															<t t-if="data['strength'].get(volume,False).get(str(conc[0]),False)">
																<span t-esc="data['strength'][volume][str(conc[0])]"></span>
															</t>
														</t>
													</t>
												</td>
											</t>
										</tr>
									</tbody> 
								</table>
							</t>
							<t t-if = "len(data['misc']) > 0">
								<table class = "table">
									<span><strong>Miscellaneous</strong></span>
									<thead>
										<th>Flavor</th>
										<th>Qty</th>
									</thead>
									<tbody>
										<t t-foreach="data['misc']" t-as = "misc">
											<tr>
												<td>
													<span t-esc="misc"></span>
												</td>
												<td>
													<span t-esc="data['misc'].get(misc,False)"></span>
												</td>
											</tr>
										</t>
										<tr>
											<td><span>Total</span></td>
											<td>
												<span t-esc="data['strength_misc']"></span>
											</td>
										</tr>
									</tbody>
								</table>
							</t>
							<t t-if = "len(data['marketing']) > 0">
								<table class = "table">
									<span><strong>Marketing</strong></span>
									<thead>
										<th>Flavor</th>
										<th>Qty</th>
									</thead>
									<tbody>
										<t t-foreach="data['marketing']" t-as = "market">
											<tr>
												<td>
													<span t-esc="market"></span>
												</td>
												<td>
													<span t-esc="data['marketing'].get(market,False)"></span>
												</td>
											</tr>
										</t>
										<tr>
											<td><span>Total</span></td>
											<td>
												<span t-esc="data['strength_marketing']"></span>
											</td>
										</tr>
									</tbody>
								</table>
							</t>							
							<t t-if = "len(data['free']) > 0">
								<table class = "table">
									<span><strong>Free Samples</strong></span>
									<thead>
										<th>Flavor</th>
										<t t-foreach = "data['conc_dict']" t-as="conc">
											<th t-esc = "conc[1]"></th>
										</t>
									</thead>
									<tbody>
										<t t-foreach="data['free']" t-as="free">
											<tr>
												<td><span t-esc="free['name']"></span></td>
												<t t-foreach = "data['conc_dict']" t-as="conc">
													<td>
														<t t-if = "str(conc[0]) in free['conc']">
															<span t-esc="free['conc'][str(conc[0])]"></span>
														</t>
													</td>
												</t>											
											</tr>
										</t>
										<tr>
											<td><span>Total</span></td>
											<t t-foreach = "data['conc_dict']" t-as="conc">
												<td>
													<t t-if = "str(conc[0]) in data['strength_free']">
														<span t-esc="data['strength_free'][str(conc[0])]"></span>
													</t>
												</td>
											</t>																						
										</tr>
									</tbody>
								</table>
							</t>
			                <table class="table table-condensed">
			                    <tbody>
			                    	<t t-if = "data['grand_total'] != 0">
					                    <tr class="border-black">
					                        <td><strong>Total Units</strong></td>
					                        <td class="text-right">
						                        <span t-esc = "data['grand_total']"></span>
					                        </td>
					                    </tr>			                    	
			                    	</t>
				                    <tr class="border-black" colspan="2" rowspan="6">
				                    	<td><strong>Order Notes</strong></td>
				                    	<td>
				                    		<span t-esc="data['comment']"></span>
				                    	</td>
				                    </tr>                	
	              			   </tbody>
	                       </table> 
			               <t t-if = "data['invoice_line']['invoice']">
								<t t-if = "data['paid_stamp']">
							        <div class="pull-right watermark" style="position:absolute;opacity:0.4;font-size:3em;width:100%;text-align:center;z-index:1000;">
										<p>
											<span t-field="o.company_id.paid_image"  t-field-options="{&quot;widget&quot;: &quot;image&quot;, &quot;class&quot;: &quot;img-rounded&quot;}"  />
										</p>		        
							        </div>																
								</t>
				                <table class="table">
					                <thead>
										<th>Invoice No.</th>
										<th>Total</th>
										<th>Paid</th>
										<th>Balance</th>				                
					                </thead>
				                    <tbody>
					                    <t t-foreach="data['invoice_line']['invoice']" t-as="invoice">
					                    	<tr>
					                    		<td><span t-esc="invoice or '/'"></span></td>
					                    		<td><span t-esc = "data['invoice_line']['invoice'][invoice]['total']"></span></td>
					                    		<td><span t-esc = "data['invoice_line']['invoice'][invoice]['paid']"></span></td>
					                    		<td><span t-esc = "data['invoice_line']['invoice'][invoice]['residual']"></span></td>
					                    	</tr>
					                    </t>
					                    <tr class = "border-black">
					                    	<td>Total</td>
					                    	<td><span t-esc = "data['invoice_line']['total']"></span></td>
					                    	<td><span t-esc = "data['invoice_line']['paid']"></span></td>
					                    	<td><span t-esc = "data['invoice_line']['residual']"></span></td>
					                    </tr>
		              			   </tbody>
		                       </table>
			                </t>
						</div>				
					</t>
				</t>
			</t>
		</template>		
		
		<report id="report_qweb_report_order_register"
		        string="Order Details"
                model="sale.order"
			    report_type="qweb-pdf"
			    file="jjuice.report_sale_order"
			    name="jjuice.report_qweb_order_attachment" />	
			    		
	</data>
</openerp>